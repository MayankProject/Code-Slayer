import Spectate from "@/components/Spectate";
import db from "../../../../../../packages/db/src";
import assert from "assert";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/authConfig";
export default async function({ params: { token } }: { params: { token: string } }) {
	const session = await getServerSession(authOptions)
	assert(session, "Unauthenticated")
	const userWithSubmission = await db.user.findFirst({
		where: {
			id: session.user.id,
			submissions: {
				some: {
					arena: {
						token: token
					}
				}
			}
		},
		select: {
			submissions: {
				where: {
					arena: {
						token: token
					}
				},
				select: {
					problemId: true,
				}
			}
		}
	});
	assert(userWithSubmission, "You haven't made any submissions in this arena");

	const users = await db.arena.findFirst({
		where: {
			token: token
		},
		select: {
			users: {
				select: {
					id: true,
					name: true,
				}
			}
		}
	});
	assert(users, "User not found");
	console.log(users);
	return (
		<Spectate usersDetails= { users?.users } />
	);
}
